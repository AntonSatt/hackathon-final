<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resilient Flow - Supply Chain Orchestration</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1e40af;
            --primary-dark: #1e3a8a;
            --secondary-color: #0891b2;
            --accent-color: #f97316;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gray-50);
            min-height: 100vh;
            color: var(--gray-900);
        }

        /* Navigation Bar */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5em;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .logo-text h1 {
            font-size: 1.8em;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 2px;
        }

        .logo-text p {
            font-size: 0.85em;
            opacity: 0.9;
            font-weight: 400;
        }

        .navbar-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .refresh-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            backdrop-filter: blur(10px);
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s;
        }

        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .stat-card.warning {
            border-left-color: var(--warning-color);
        }

        .stat-card.success {
            border-left-color: var(--success-color);
        }

        .stat-card.info {
            border-left-color: var(--secondary-color);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stat-icon {
            font-size: 2em;
            opacity: 0.8;
        }

        .stat-label {
            font-size: 0.85em;
            color: var(--gray-600);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1;
        }

        /* Two Column Layout */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (min-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Card Sections */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .card-header {
            padding: 20px 25px;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.25em;
            font-weight: 600;
            color: var(--gray-900);
        }

        .card-title-icon {
            font-size: 1.3em;
        }

        .card-body {
            padding: 25px;
        }

        /* Form Sections */
        .form-section-label {
            font-size: 0.95em;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--gray-700);
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .label-icon {
            font-size: 1.1em;
        }

        .required-star {
            color: var(--error-color);
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            font-size: 1.1em;
            pointer-events: none;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 14px;
            padding-left: 42px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .form-group select {
            padding-left: 42px;
            background-color: white;
            cursor: pointer;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .form-group input:valid,
        .form-group select:valid {
            border-color: var(--success-color);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px -2px rgba(30, 64, 175, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-full {
            width: 100%;
        }

        /* Resolution Option Cards */
        .resolution-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .resolution-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            padding: 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .resolution-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.15);
            transform: translateY(-2px);
        }

        .resolution-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .resolution-card:hover::before {
            opacity: 1;
        }

        .resolution-card.premium::before {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }

        .resolution-card.fast::before {
            background: linear-gradient(90deg, var(--success-color), #059669);
        }

        .resolution-card.moderate::before {
            background: linear-gradient(90deg, var(--warning-color), #d97706);
        }

        .resolution-card.standard::before {
            background: linear-gradient(90deg, var(--gray-500), var(--gray-600));
        }

        .resolution-icon {
            font-size: 2em;
            margin-bottom: 8px;
            display: block;
        }

        .resolution-name {
            font-weight: 600;
            font-size: 0.9em;
            color: var(--gray-900);
            margin-bottom: 6px;
        }

        .resolution-cost {
            font-weight: 700;
            color: var(--error-color);
            font-size: 1.1em;
            margin-bottom: 4px;
        }

        .resolution-cost.free {
            color: var(--success-color);
        }

        .resolution-time {
            font-size: 0.75em;
            color: var(--gray-500);
            font-weight: 500;
        }

        /* Timeline Animation */
        .timeline-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 8px;
        }

        .timeline-stage {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            flex: 1;
            position: relative;
        }

        .timeline-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: all 0.3s;
            z-index: 2;
        }

        .timeline-stage.completed .timeline-dot {
            background: var(--success-color);
            color: white;
        }

        .timeline-stage.active .timeline-dot {
            background: var(--primary-color);
            color: white;
            animation: timelinePulse 2s infinite;
            box-shadow: 0 0 0 0 rgba(30, 64, 175, 0.4);
        }

        @keyframes timelinePulse {
            0% {
                box-shadow: 0 0 0 0 rgba(30, 64, 175, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(30, 64, 175, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(30, 64, 175, 0);
            }
        }

        .timeline-stage.issue .timeline-dot {
            background: var(--error-color);
            color: white;
            animation: issueShake 0.5s ease-in-out;
        }

        @keyframes issueShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .timeline-label {
            font-size: 0.7em;
            color: var(--gray-600);
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
        }

        .timeline-stage.active .timeline-label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .timeline-stage.completed .timeline-label {
            color: var(--success-color);
        }

        .timeline-line {
            position: absolute;
            top: 12px;
            left: 50%;
            right: -50%;
            height: 2px;
            background: var(--gray-300);
            z-index: 1;
        }

        .timeline-stage.completed .timeline-line {
            background: var(--success-color);
        }

        .timeline-stage:last-child .timeline-line {
            display: none;
        }

        /* Active shipment indicator */
        .active-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(30, 64, 175, 0.1);
            border-radius: 12px;
            font-size: 0.75em;
            color: var(--primary-color);
            font-weight: 600;
            margin-left: 8px;
        }

        .spinner-icon {
            width: 12px;
            height: 12px;
            border: 2px solid var(--primary-color);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 16px 14px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        td {
            padding: 16px 14px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.9em;
        }

        tbody tr {
            transition: background-color 0.5s ease, border-left-color 0.5s ease;
        }

        tbody tr:hover {
            background-color: var(--gray-50);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* Smooth cell updates */
        td {
            transition: all 0.5s ease;
        }

        .cell-updated {
            animation: subtleFlash 1s ease-out;
        }

        @keyframes subtleFlash {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(30, 64, 175, 0.05); }
        }

        /* Status-based row styling */
        .status-issue {
            background-color: #fef2f2 !important;
            border-left: 4px solid var(--error-color);
        }

        .status-issue:hover {
            background-color: #fee2e2 !important;
        }

        .status-transit {
            background-color: #fffbeb !important;
            border-left: 4px solid var(--warning-color);
        }

        .status-transit:hover {
            background-color: #fef3c7 !important;
        }

        .status-delivered {
            background-color: #f0fdf4 !important;
            border-left: 4px solid var(--success-color);
        }

        .status-delivered:hover {
            background-color: #dcfce7 !important;
        }

        .status-pending {
            background-color: #eff6ff !important;
            border-left: 4px solid var(--secondary-color);
        }

        .status-pending:hover {
            background-color: #dbeafe !important;
        }

        .status-customs {
            background-color: #faf5ff !important;
            border-left: 4px solid #a855f7;
        }

        .status-customs:hover {
            background-color: #f3e8ff !important;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge-issue {
            background-color: var(--error-color);
            color: white;
        }

        .badge-transit {
            background-color: var(--warning-color);
            color: white;
        }

        .badge-delivered {
            background-color: var(--success-color);
            color: white;
        }

        .badge-pending {
            background-color: var(--secondary-color);
            color: white;
        }

        .badge-customs {
            background-color: #a855f7;
            color: white;
        }

        .priority-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 8px;
        }

        .priority-critical {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .priority-high {
            background-color: #fef3c7;
            color: #92400e;
        }

        .priority-standard {
            background-color: #e0e7ff;
            color: #3730a3;
        }

        .issue-text {
            color: var(--error-color);
            font-weight: 500;
            font-size: 0.9em;
            padding: 8px 12px;
            background: #fef2f2;
            border-radius: 6px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loading {
            text-align: center;
            padding: 60px 40px;
            color: var(--gray-500);
            font-size: 1em;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 16px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left-color: var(--error-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 1.5em;
        }

        .toast-message {
            flex: 1;
            font-size: 0.9em;
            font-weight: 500;
        }

        /* Shipment ID Cell */
        .shipment-id-cell {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--primary-color);
        }

        .value-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: var(--gray-100);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--gray-700);
        }

        /* Modal Popup */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 2px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gray-100);
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            color: var(--gray-600);
        }

        .modal-close:hover {
            background: var(--error-color);
            color: white;
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        /* Quick Action Buttons */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-btn {
            padding: 30px;
            border: 3px solid var(--gray-200);
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            text-align: center;
        }

        .action-btn:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.05), rgba(8, 145, 178, 0.05));
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(30, 64, 175, 0.15);
        }

        .action-btn-icon {
            font-size: 3em;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .action-btn-title {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--gray-900);
        }

        .action-btn-desc {
            font-size: 0.9em;
            color: var(--gray-600);
        }

        /* Active Shipments Section */
        .active-shipments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .active-shipment-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .active-shipment-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .active-shipment-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 16px rgba(30, 64, 175, 0.15);
            transform: translateY(-2px);
        }

        .active-shipment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .active-shipment-id {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 0.9em;
            color: var(--primary-color);
        }

        .active-shipment-project {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .active-shipment-route {
            font-size: 0.85em;
            color: var(--gray-600);
            margin-bottom: 12px;
        }

        @media (max-width: 768px) {
            .quick-actions {
                grid-template-columns: 1fr;
            }

            .active-shipments-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr !important;
            }

            .navbar-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .logo-text h1 {
                font-size: 1.5em;
            }

            th, td {
                padding: 10px 8px;
                font-size: 0.85em;
            }

            .resolution-options {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo-section">
                <div class="logo-icon">üîÑ</div>
                <div class="logo-text">
                    <h1>Resilient Flow</h1>
                    <p>Intelligent Supply Chain Orchestration</p>
                </div>
            </div>
            <div class="navbar-actions">
                <div class="refresh-indicator">
                    <div class="pulse-dot"></div>
                    <span>Live Updates</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard Stats -->
        <div class="stats-grid">
            <div class="stat-card info">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Total Shipments</div>
                        <div class="stat-value" id="stat-total">0</div>
                    </div>
                    <div class="stat-icon">üì¶</div>
                </div>
            </div>
            <div class="stat-card warning">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Issues Detected</div>
                        <div class="stat-value" id="stat-issues">0</div>
                    </div>
                    <div class="stat-icon">‚ö†Ô∏è</div>
                </div>
            </div>
            <div class="stat-card success">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Delivered</div>
                        <div class="stat-value" id="stat-delivered">0</div>
                    </div>
                    <div class="stat-icon">‚úÖ</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">In Transit</div>
                        <div class="stat-value" id="stat-transit">0</div>
                    </div>
                    <div class="stat-icon">üöö</div>
                </div>
            </div>
        </div>

        <!-- Quick Action Buttons -->
        <div class="quick-actions">
            <div class="action-btn" onclick="generateRandomShipment()">
                <div class="action-btn-icon">üé≤</div>
                <div class="action-btn-title">Quick Random Shipment</div>
                <div class="action-btn-desc">Generate a shipment with funny random details</div>
            </div>
            <div class="action-btn" onclick="openCustomModal()">
                <div class="action-btn-icon">‚ûï</div>
                <div class="action-btn-title">Create Custom Shipment</div>
                <div class="action-btn-desc">Enter your own shipment details</div>
            </div>
        </div>

        <!-- Active Shipments Section -->
        <div class="card" id="active-shipments-section" style="display: none;">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-title-icon">ÔøΩÔøΩ</span>
                    Active Shipments
                </div>
                <span id="active-count" style="background: var(--primary-color); color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600; font-size: 0.9em;">0</span>
            </div>
            <div class="table-container">
                <table id="active-shipments-table">
                    <thead>
                        <tr>
                            <th>üì¶ Shipment ID</th>
                            <th>üìã Project</th>
                            <th>üè¢ Supplier</th>
                            <th>üìç Origin</th>
                            <th>üéØ Destination</th>
                            <th>üöö Current Location</th>
                            <th>üìä Status</th>
                            <th>‚öôÔ∏è Details / Actions</th>
                        </tr>
                    </thead>
                    <tbody id="active-shipments-tbody">
                        <!-- Active shipments will be rendered here -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- All Shipments Table -->
        <div class="card" style="margin-top: 30px;">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-title-icon">üìä</span>
                    All Shipments
                </div>
            </div>
            <div class="table-container">
                <table id="shipments-table">
                    <thead>
                        <tr>
                            <th>üì¶ Shipment ID</th>
                            <th>üìã Project</th>
                            <th>üè¢ Supplier</th>
                            <th>üìç Origin</th>
                            <th>üéØ Destination</th>
                            <th>üöö Current Location</th>
                            <th>üìä Status</th>
                            <th>‚öôÔ∏è Details / Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="8" class="loading">
                                <div class="loading-spinner"></div>
                                <div>Loading shipments...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Custom Shipment Modal -->
    <div class="modal-overlay" id="custom-modal" onclick="closeModalOnOutside(event)">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span>‚ûï</span>
                    Create Custom Shipment
                </div>
                <button class="modal-close" onclick="closeCustomModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="create-shipment-form">
                    <!-- Shipment Details Section -->
                    <div class="form-section-label">
                        üìù Shipment Details
                    </div>
                    <div class="form-grid" style="margin-bottom: 25px;">
                        <div class="form-group">
                            <label for="project_name">
                                <span class="label-icon">üìã</span>
                                Project Name / Cargo Description
                                <span class="required-star">*</span>
                            </label>
                            <div class="input-wrapper">
                                <span class="input-icon">üìã</span>
                                <input 
                                    type="text" 
                                    id="project_name" 
                                    name="project_name" 
                                    placeholder="e.g., Q4 Electronics Deployment"
                                    required
                                >
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="supplier_name">
                                <span class="label-icon">üè¢</span>
                                Supplier / Vendor Name
                                <span class="required-star">*</span>
                            </label>
                            <div class="input-wrapper">
                                <span class="input-icon">üè¢</span>
                                <input 
                                    type="text" 
                                    id="supplier_name" 
                                    name="supplier_name" 
                                    placeholder="e.g., Acme Electronics Inc."
                                    required
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Route Information Section -->
                    <div class="form-section-label">
                        üåç Route Information
                    </div>
                    <div class="form-grid" style="margin-bottom: 25px;">
                        <div class="form-group">
                            <label for="origin">
                                <span class="label-icon">üìç</span>
                                Origin Port / Location
                                <span class="required-star">*</span>
                            </label>
                            <div class="input-wrapper">
                                <span class="input-icon">üìç</span>
                                <input 
                                    type="text" 
                                    id="origin" 
                                    name="origin" 
                                    placeholder="e.g., Shanghai, China"
                                    value="Warehouse Alpha"
                                    required
                                >
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="destination">
                                <span class="label-icon">üéØ</span>
                                Destination Port / Location
                                <span class="required-star">*</span>
                            </label>
                            <div class="input-wrapper">
                                <span class="input-icon">üéØ</span>
                                <input 
                                    type="text" 
                                    id="destination" 
                                    name="destination" 
                                    placeholder="e.g., New York, USA"
                                    required
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Cargo Specifications Section -->
                    <div class="form-section-label">
                        üìä Cargo Specifications
                    </div>
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="form-group">
                            <label for="cargo_value">
                                <span class="label-icon">üí∞</span>
                                Cargo Value (USD)
                            </label>
                            <div class="input-wrapper">
                                <span class="input-icon">üí∞</span>
                                <input 
                                    type="number" 
                                    id="cargo_value" 
                                    name="cargo_value" 
                                    placeholder="250000"
                                    min="0"
                                    step="1000"
                                >
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="priority">
                                <span class="label-icon">‚ö°</span>
                                Priority Level
                                <span class="required-star">*</span>
                            </label>
                            <div class="input-wrapper">
                                <span class="input-icon">‚ö°</span>
                                <select id="priority" name="priority" required>
                                    <option value="Standard">Standard</option>
                                    <option value="High">High</option>
                                    <option value="Critical">Critical</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="container_type">
                                <span class="label-icon">üì¶</span>
                                Container Type
                            </label>
                            <div class="input-wrapper">
                                <span class="input-icon">üì¶</span>
                                <select id="container_type" name="container_type">
                                    <option value="20ft Standard">20ft Standard</option>
                                    <option value="40ft Standard">40ft Standard</option>
                                    <option value="40ft High Cube">40ft High Cube</option>
                                    <option value="Refrigerated">Refrigerated</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full" style="margin-top: 25px;">
                        <span>ÔøΩ</span>
                        Create Shipment & Start Workflow
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container (for notifications) -->
    <div id="toast-container"></div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        
        // Store previous shipments state for comparison
        let previousShipments = {};

        // Random data for quick shipment generation
        const randomData = {
            projectNames: [
                "Operation Rubber Duck",
                "Project Unicorn Sparkles",
                "Mission Impossible Paperclips",
                "The Great Donut Deployment",
                "Tactical Banana Strategy",
                "Nuclear Coffee Beans Initiative",
                "Secret Sock Syndicate",
                "Epic Stapler Expedition",
                "Quantum Pencil Protocol",
                "Intergalactic Toilet Paper Supply",
                "Top Secret Bubble Wrap Cache",
                "Emergency Pizza Reserves",
                "Critical Nerf Gun Arsenal",
                "Classified Rubber Band Ball",
                "Urgent Googly Eyes Shipment",
                "Legendary Fidget Spinner Fleet",
                "Mysterious Rubber Chicken Cargo",
                "Covert Whoopee Cushion Collection",
                "Supreme Foam Finger Delivery",
                "Strategic Duct Tape Reserve",
                // NEW: Pop culture & humor additions
                "Galactic Rubber Duck Armada",
                "Operation Flying Spaghetti Monster",
                "Project Laser Cats from Space",
                "Mission Sneaky Pandas Strike Back",
                "The Bacon Protocol Initiative",
                "Avengers: Endgame Office Supplies",
                "Jurassic Stapler Park",
                "Star Wars: Attack of the Keyboards",
                "Lord of the Printer Rings",
                "Harry Potter and the Cursed Shipment",
                "Game of Staplers: Winter Edition",
                "Breaking Bad: The Meth Lab Furniture",
                "The Walking Dead Toilet Paper Run",
                "Stranger Things: The Upside Down Boxes",
                "Rick & Morty Portal Gun Batteries",
                "SpongeBob's Secret Krabby Patty Formula",
                "Shrek's Swamp Furniture Collection",
                "Minecraft Diamond Block Expedition",
                "Pok√©mon: Gotta Ship 'Em All",
                "Among Us: Emergency Meeting Supplies",
                "Fortnite Victory Royale Loot",
                "Baby Yoda Merch Madness",
                "Doge to the Moon Rocket Fuel",
                "Pepe the Frog Retirement Fund",
                "Nyan Cat Rainbow Generator Parts",
                "Chuck Norris Approved Roundhouse Kicks",
                "Elon Musk's Twitter Buyout Receipts",
                "Jeff Bezos' Space Cowboy Hat",
                "Mark Zuckerberg's Metaverse Furniture",
                "Bill Gates' Microchip Conspiracy Box"
            ],
            suppliers: [
                "Acme Absurdities Inc.",
                "Wacky Widgets Ltd.",
                "Peculiar Products GmbH",
                "Bizarre Bazaar Corp.",
                "Oddball Industries",
                "Quirky Quarters LLC",
                "Funky Freight Co.",
                "Silly Supply Chain SA",
                "Goofy Goods International",
                "Zany Zone Enterprises",
                "Ridiculous Resources Ltd.",
                "Laughable Logistics Inc.",
                "Bonkers Bros. Trading",
                "Crazy Cargo Company",
                "Whimsical Warehouse Corp.",
                "Nonsense & Sons Ltd."
            ],
            origins: [
                "Silicon Valley, USA",
                "Shenzhen, China",
                "Hamburg, Germany",
                "Rotterdam, Netherlands",
                "Singapore City, Singapore",
                "Dubai, UAE",
                "Tokyo, Japan",
                "Seoul, South Korea",
                "Mumbai, India",
                "S√£o Paulo, Brazil"
            ],
            destinations: [
                "New York, USA",
                "London, UK",
                "Paris, France",
                "Sydney, Australia",
                "Toronto, Canada",
                "Berlin, Germany",
                "Stockholm, Sweden",
                "Copenhagen, Denmark",
                "Oslo, Norway",
                "Amsterdam, Netherlands",
                "Barcelona, Spain",
                "Rome, Italy",
                "Athens, Greece",
                "Istanbul, Turkey",
                "Moscow, Russia",
                "Beijing, China",
                "Bangkok, Thailand",
                "Melbourne, Australia",
                "Auckland, New Zealand",
                "Mexico City, Mexico"
            ],
            containerTypes: [
                "20ft Standard",
                "40ft Standard",
                "40ft High Cube",
                "Refrigerated"
            ],
            priorities: ["Standard", "High", "Critical"]
        };

        /**
         * Modal control functions
         */
        function openCustomModal() {
            document.getElementById('custom-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCustomModal() {
            document.getElementById('custom-modal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function closeModalOnOutside(event) {
            if (event.target.id === 'custom-modal') {
                closeCustomModal();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeCustomModal();
        });

        /**
         * Generate and submit a random shipment
         */
        async function generateRandomShipment() {
            const random = (arr) => arr[Math.floor(Math.random() * arr.length)];
            
            const shipmentData = {
                project_name: random(randomData.projectNames),
                supplier_name: random(randomData.suppliers),
                origin: random(randomData.origins),
                destination: random(randomData.destinations),
                cargo_value: Math.floor(Math.random() * 500000) + 50000, // $50k - $550k
                priority: random(randomData.priorities),
                container_type: random(randomData.containerTypes)
            };

            try {
                showToast(`üé≤ Creating random shipment: "${shipmentData.project_name}"...`, 'warning');
                
                const response = await fetch(`${API_BASE_URL}/api/shipments/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(shipmentData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Random shipment created:', result);
                
                // Immediately refresh to show the new shipment
                await getShipments();
                
                showToast(`üéâ Random shipment ${result.shipment_id} created!`, 'success');
            } catch (error) {
                console.error('Error creating random shipment:', error);
                showToast(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        /**
         * Show toast notification
         */
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-message">${message}</div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        /**
         * Update dashboard statistics
         */
        function updateStats(shipments) {
            const shipmentsArray = Object.values(shipments);
            
            const total = shipmentsArray.length;
            const issues = shipmentsArray.filter(s => s.status === 'Issue Detected').length;
            const delivered = shipmentsArray.filter(s => s.status === 'Delivered').length;
            const inTransit = shipmentsArray.filter(s => s.status === 'In Transit').length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-issues').textContent = issues;
            document.getElementById('stat-delivered').textContent = delivered;
            document.getElementById('stat-transit').textContent = inTransit;
            
            // Render active shipments
            renderActiveShipments(shipments);
        }

        /**
         * Render active shipments section
         */
        function renderActiveShipments(shipments) {
            const shipmentsArray = Object.values(shipments);
            const activeShipments = shipmentsArray.filter(s => s.status !== 'Delivered');
            
            const section = document.getElementById('active-shipments-section');
            const tbody = document.getElementById('active-shipments-tbody');
            const countBadge = document.getElementById('active-count');
            
            if (activeShipments.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            countBadge.textContent = activeShipments.length;
            
            // Sort by newest first
            activeShipments.sort((a, b) => b.shipment_id.localeCompare(a.shipment_id));
            
            tbody.innerHTML = activeShipments.map(shipment => {
                const statusIcon = getStatusIcon(shipment.status);
                const isActive = isShipmentActive(shipment.status);
                
                // Determine row CSS class based on status
                let rowClass = '';
                if (shipment.status === 'Issue Detected') {
                    rowClass = 'status-issue';
                } else if (shipment.status === 'In Transit') {
                    rowClass = 'status-transit';
                } else if (shipment.status === 'Pending') {
                    rowClass = 'status-pending';
                } else if (shipment.status.includes('Customs')) {
                    rowClass = 'status-customs';
                }

                // Priority badge
                let priorityBadge = '';
                if (shipment.priority) {
                    const priorityClass = `priority-${shipment.priority.toLowerCase()}`;
                    const priorityIcon = getPriorityIcon(shipment.priority);
                    priorityBadge = `<span class="priority-badge ${priorityClass}">${priorityIcon} ${shipment.priority}</span>`;
                }

                // Active indicator
                const activeIndicator = isActive 
                    ? `<span class="active-indicator"><div class="spinner-icon"></div> Processing</span>`
                    : '';

                // Cargo value display
                const cargoValue = shipment.cargo_value 
                    ? `<span class="value-badge">üí∞ $${parseInt(shipment.cargo_value).toLocaleString()}</span>`
                    : '-';

                // Details cell content
                let detailsCell = '';
                if (shipment.status === 'Issue Detected') {
                    // Show issue text and resolution options
                    detailsCell = `
                        <div>
                            <div class="issue-text">‚ö†Ô∏è ${shipment.issue_details || 'Issue detected'}</div>
                            <div class="resolution-options">
                                <div class="resolution-card premium" onclick="resolveIssue('${shipment.shipment_id}', 'expedite')">
                                    <span class="resolution-icon">‚ö°</span>
                                    <div class="resolution-name">Express</div>
                                    <div class="resolution-cost">+$5,000</div>
                                    <div class="resolution-time">~30s</div>
                                </div>
                                <div class="resolution-card fast" onclick="resolveIssue('${shipment.shipment_id}', 'bribe_official')">
                                    <span class="resolution-icon">üíº</span>
                                    <div class="resolution-name">Facilitation</div>
                                    <div class="resolution-cost">+$2,500</div>
                                    <div class="resolution-time">~40s</div>
                                </div>
                                <div class="resolution-card moderate" onclick="resolveIssue('${shipment.shipment_id}', 'reroute')">
                                    <span class="resolution-icon">üîÑ</span>
                                    <div class="resolution-name">Reroute</div>
                                    <div class="resolution-cost">+$3,200</div>
                                    <div class="resolution-time">~50s</div>
                                </div>
                                <div class="resolution-card standard" onclick="resolveIssue('${shipment.shipment_id}', 'wait')">
                                    <span class="resolution-icon">‚è≥</span>
                                    <div class="resolution-name">Wait</div>
                                    <div class="resolution-cost free">Free</div>
                                    <div class="resolution-time">~60s</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // Show timeline for all active shipments
                    detailsCell = createTimeline(shipment.status);
                }

                return `
                    <tr class="${rowClass}">
                        <td class="shipment-id-cell">${shipment.shipment_id}</td>
                        <td>
                            <strong>${shipment.project_name || 'Unknown Project'}</strong>
                            ${priorityBadge}
                        </td>
                        <td>${shipment.supplier_name || '-'}</td>
                        <td>${shipment.origin || '-'}</td>
                        <td>${shipment.destination || '-'}</td>
                        <td>${shipment.current_location || '-'}</td>
                        <td>
                            <span class="status-badge ${getStatusBadgeClass(shipment.status)}">
                                ${statusIcon} ${shipment.status}
                            </span>
                            ${activeIndicator}
                        </td>
                        <td>${detailsCell}</td>
                    </tr>
                `;
            }).join('');
        }

        /**
         * Get status badge class
         */
        function getStatusBadgeClass(status) {
            if (status === 'Issue Detected') return 'badge-issue';
            if (status === 'In Transit') return 'badge-transit';
            if (status === 'Delivered') return 'badge-delivered';
            if (status === 'Pending') return 'badge-pending';
            if (status.includes('Customs')) return 'badge-customs';
            return 'badge-pending';
        }

        /**
         * Update dashboard statistics
         */


        /**
         * Get timeline stage based on status
         */
        function getTimelineStage(status) {
            const stages = ['Pending', 'In Transit', 'At Customs', 'Issue Detected', 'Cleared Customs', 'Delivered'];
            const stage = stages.indexOf(status);
            return stage >= 0 ? stage : 0;
        }

        /**
         * Create timeline HTML
         */
        function createTimeline(status) {
            const stages = [
                { name: 'Pending', icon: '‚è≥' },
                { name: 'In Transit', icon: 'üöö' },
                { name: 'At Customs', icon: 'üõÉ' },
                { name: 'Issue', icon: '‚ö†Ô∏è' },
                { name: 'Cleared', icon: '‚úÖ' },
                { name: 'Delivered', icon: 'üéâ' }
            ];

            const currentStage = getTimelineStage(status);
            
            return `
                <div class="timeline-container">
                    ${stages.map((stage, index) => {
                        let stageClass = '';
                        if (index < currentStage) stageClass = 'completed';
                        else if (index === currentStage) {
                            if (status === 'Issue Detected') stageClass = 'issue';
                            else stageClass = 'active';
                        }
                        
                        return `
                            <div class="timeline-stage ${stageClass}">
                                <div class="timeline-dot">${stage.icon}</div>
                                <div class="timeline-label">${stage.name}</div>
                                ${index < stages.length - 1 ? '<div class="timeline-line"></div>' : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        /**
         * Check if shipment is active (not delivered, not waiting for issue resolution)
         */
        function isShipmentActive(status) {
            return status !== 'Delivered' && status !== 'Issue Detected';
        }

        /**
         * Get status icon based on status
         */
        function getStatusIcon(status) {
            const icons = {
                'Pending': '‚è≥',
                'In Transit': 'üöö',
                'At Customs': 'üõÉ',
                'Issue Detected': '‚ö†Ô∏è',
                'Cleared Customs': '‚úÖ',
                'Delivered': 'üéâ'
            };
            return icons[status] || 'üì¶';
        }

        /**
         * Get priority icon
         */
        function getPriorityIcon(priority) {
            const icons = {
                'Critical': 'üî¥',
                'High': '‚ö°',
                'Standard': 'üìã'
            };
            return icons[priority] || 'üìã';
        }

        /**
         * Fetch all shipments from the API and render them in the table
         */
        async function getShipments() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/shipments`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const shipments = await response.json();
                updateStats(shipments);
                
                // Smart update: only re-render if data actually changed
                if (JSON.stringify(shipments) !== JSON.stringify(previousShipments)) {
                    renderShipmentsTable(shipments, previousShipments);
                    previousShipments = JSON.parse(JSON.stringify(shipments));
                }
            } catch (error) {
                console.error('Error fetching shipments:', error);
                const tbody = document.querySelector('#shipments-table tbody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="loading" style="color: var(--error-color);">
                            ‚ö†Ô∏è Error loading shipments. Make sure the API server is running at ${API_BASE_URL}
                        </td>
                    </tr>
                `;
            }
        }

        /**
         * Render the shipments table with data
         */
        function renderShipmentsTable(shipments, previousData = {}) {
            const tbody = document.querySelector('#shipments-table tbody');
            
            // Check if shipments object is empty
            if (Object.keys(shipments).length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="loading">
                            <div style="font-size: 1.2em; margin-bottom: 10px;">üì¶</div>
                            No shipments found. Create your first shipment above!
                        </td>
                    </tr>
                `;
                return;
            }

            // Convert object to array and sort by shipment_id (newest first)
            const shipmentsArray = Object.values(shipments).sort((a, b) => {
                return b.shipment_id.localeCompare(a.shipment_id);
            });

            tbody.innerHTML = shipmentsArray.map(shipment => {
                const previous = previousData[shipment.shipment_id];
                const hasChanged = previous && JSON.stringify(previous) !== JSON.stringify(shipment);
                
                // Determine row CSS class based on status
                let rowClass = '';
                let badgeClass = '';
                
                if (shipment.status === 'Issue Detected') {
                    rowClass = 'status-issue';
                    badgeClass = 'badge-issue';
                } else if (shipment.status === 'In Transit') {
                    rowClass = 'status-transit';
                    badgeClass = 'badge-transit';
                } else if (shipment.status === 'Delivered') {
                    rowClass = 'status-delivered';
                    badgeClass = 'badge-delivered';
                } else if (shipment.status === 'Pending') {
                    rowClass = 'status-pending';
                    badgeClass = 'badge-pending';
                } else if (shipment.status.includes('Customs')) {
                    rowClass = 'status-customs';
                    badgeClass = 'badge-customs';
                }

                // Priority badge
                let priorityBadge = '';
                if (shipment.priority) {
                    const priorityClass = `priority-${shipment.priority.toLowerCase()}`;
                    const priorityIcon = getPriorityIcon(shipment.priority);
                    priorityBadge = `<span class="priority-badge ${priorityClass}">${priorityIcon} ${shipment.priority}</span>`;
                }

                // Active indicator
                const isActive = isShipmentActive(shipment.status);
                const activeIndicator = isActive 
                    ? `<span class="active-indicator"><div class="spinner-icon"></div> Processing</span>`
                    : '';

                // Cargo value display
                const cargoValue = shipment.cargo_value 
                    ? `<span class="value-badge">üí∞ $${parseInt(shipment.cargo_value).toLocaleString()}</span>`
                    : '-';

                // Determine the Details / Actions cell content
                let detailsCell = '';
                if (shipment.status === 'Issue Detected') {
                    // Show resolution option cards
                    detailsCell = `
                        <div>
                            <div class="issue-text">
                                <span>‚ö†Ô∏è</span>
                                <strong>${shipment.issue_details || 'Issue detected'}</strong>
                            </div>
                            <div class="resolution-options">
                                <div class="resolution-card premium" onclick="resolveIssue('${shipment.shipment_id}', 'expedite')">
                                    <span class="resolution-icon">‚ö°</span>
                                    <div class="resolution-name">Express</div>
                                    <div class="resolution-cost">+$5,000</div>
                                    <div class="resolution-time">~30 sec</div>
                                </div>
                                <div class="resolution-card fast" onclick="resolveIssue('${shipment.shipment_id}', 'bribe_official')">
                                    <span class="resolution-icon">üí∞</span>
                                    <div class="resolution-name">Facilitation</div>
                                    <div class="resolution-cost">+$2,500</div>
                                    <div class="resolution-time">~40 sec</div>
                                </div>
                                <div class="resolution-card moderate" onclick="resolveIssue('${shipment.shipment_id}', 'reroute')">
                                    <span class="resolution-icon">üîÑ</span>
                                    <div class="resolution-name">Reroute</div>
                                    <div class="resolution-cost">+$3,200</div>
                                    <div class="resolution-time">~50 sec</div>
                                </div>
                                <div class="resolution-card standard" onclick="resolveIssue('${shipment.shipment_id}', 'wait')">
                                    <span class="resolution-icon">‚è≥</span>
                                    <div class="resolution-name">Wait</div>
                                    <div class="resolution-cost free">Free</div>
                                    <div class="resolution-time">~60 sec</div>
                                </div>
                            </div>
                            ${createTimeline(shipment.status)}
                        </div>
                    `;
                } else {
                    // Show timeline for all active shipments
                    detailsCell = `
                        <div>
                            ${shipment.cargo_value ? cargoValue : ''}
                            ${createTimeline(shipment.status)}
                        </div>
                    `;
                }

                const statusIcon = getStatusIcon(shipment.status);

                return `
                    <tr class="${rowClass}">
                        <td><span class="shipment-id-cell">${shipment.shipment_id}</span></td>
                        <td>
                            <strong>${shipment.project_name || '-'}</strong>
                            ${priorityBadge}
                            ${activeIndicator}
                            ${shipment.container_type ? `<div style="font-size: 0.8em; color: var(--gray-500); margin-top: 4px;">üì¶ ${shipment.container_type}</div>` : ''}
                        </td>
                        <td>${shipment.supplier_name}</td>
                        <td>üìç ${shipment.origin}</td>
                        <td>üéØ ${shipment.destination}</td>
                        <td>${shipment.current_location || '-'}</td>
                        <td><span class="status-badge ${badgeClass}">${statusIcon} ${shipment.status}</span></td>
                        <td>${detailsCell}</td>
                    </tr>
                `;
            }).join('');
        }

        /**
         * Resolve a shipment issue by sending a signal to the workflow
         */
        async function resolveIssue(shipmentId, choice) {
            const choiceNames = {
                'expedite': 'Express Clearance ($5,000)',
                'bribe_official': 'Facilitation Fee ($2,500)',
                'reroute': 'Reroute Shipment ($3,200)',
                'wait': 'Standard Wait (Free)'
            };

            try {
                showToast(`Sending resolution: ${choiceNames[choice]}...`, 'warning');
                
                const response = await fetch(
                    `${API_BASE_URL}/api/shipments/${shipmentId}/resolve`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ choice: choice })
                    }
                );

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Resolution sent:', result);
                
                // Immediately refresh to show the update
                await getShipments();
                
                showToast(`‚úÖ ${choiceNames[choice]} applied! Workflow resumed.`, 'success');
            } catch (error) {
                console.error('Error resolving issue:', error);
                showToast(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        /**
         * Handle form submission to create a new shipment
         */
        document.getElementById('create-shipment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const shipmentData = {
                project_name: formData.get('project_name'),
                supplier_name: formData.get('supplier_name'),
                origin: formData.get('origin'),
                destination: formData.get('destination'),
                cargo_value: formData.get('cargo_value') || null,
                priority: formData.get('priority'),
                container_type: formData.get('container_type')
            };

            // Disable submit button
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span style="display: inline-block; width: 16px; height: 16px; border: 3px solid white; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></span> Creating...';

            try {
                showToast('Creating custom shipment...', 'warning');
                
                const response = await fetch(`${API_BASE_URL}/api/shipments/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(shipmentData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Shipment created:', result);
                
                // Clear the form
                e.target.reset();
                
                // Close modal
                closeCustomModal();
                
                // Immediately refresh to show the new shipment
                await getShipments();
                
                showToast(`üöÄ Shipment ${result.shipment_id} created! Workflow started.`, 'success');
            } catch (error) {
                console.error('Error creating shipment:', error);
                showToast(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Initial load
        getShipments();

        // Auto-refresh every 2 seconds for "realtime" updates
        setInterval(getShipments, 2000);
    </script>
</body>
</html>
